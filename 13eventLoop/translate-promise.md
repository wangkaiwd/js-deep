## `JavaScript`å¯è§†åŒ–ï¼š`Promise`å’Œ`Asnyc/Await`
æ›¾ç»å¿…ä¸å¾—ä¸å¤„ç†æ²¡æœ‰æŒ‰ç…§ä½ æœŸæœ›çš„æ–¹å¼è¿è¡Œçš„`JS`ä»£ç å—ï¼Ÿå¯èƒ½æ˜¯å‡½æ•°è¢«éšæœºçš„ã€ä¸å¯é¢„æµ‹æ—¶é—´çš„æ‰§è¡Œï¼Œæˆ–è€…è¢«å»¶è¿Ÿæ‰§è¡Œã€‚ä½ å¯èƒ½æ­£åœ¨å¤„ç†`ES6`å¼•å…¥çš„ä¸€ä¸ªéå¸¸é…·çš„æ–°ç‰¹æ€§:`Promise`!

æˆ‘å¤šå¹´ä¹‹å‰çš„å¥½å¥‡å¿ƒå·²ç»å¾—åˆ°äº†å›æŠ¥ï¼Œåœ¨ä¸çœ çš„å¤œæ™šå†æ¬¡ç»™äº†æˆ‘æ—¶é—´æ¥åˆ¶ä½œä¸€äº›åŠ¨ç”»ã€‚æ˜¯æ—¶å€™æ¥è°ˆè®º`Promise`äº†ï¼šä¸ºä»€ä¹ˆä½ è¦ä½¿ç”¨å®ƒä»¬ï¼Œå®ƒä»¬åœ¨åº•å±‚æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠæˆ‘ä»¬å¦‚ä½•èƒ½ç”¨æœ€ç°ä»£çš„æ–¹å¼æ¥ä¹¦å†™å®ƒä»¬ï¼Ÿ

> å¦‚æœä½ è¿˜æ²¡æœ‰é˜…è¯»æˆ‘ä¹‹å‰å‘è¡¨çš„æ–‡ç« `JavaScript`äº‹ä»¶å¾ªç¯ï¼Œé‚£ä¹ˆå…ˆå»é˜…è¯»ä¸€ä¸‹å¯èƒ½ä¼šå¥½ç†è§£è¿™ç¯‡æ–‡ç« ã€‚æˆ‘å°†ä¼šå†æ¬¡æ¶‰åŠäº‹ä»¶å¾ªç¯ï¼Œå‡è®¾ä¸€äº›å…³äºè°ƒç”¨æ ˆã€`Web API`å’Œé˜Ÿåˆ—ç­‰åŸºç¡€çŸ¥è¯†ï¼Œä½†æ˜¯è¿™æ¬¡æˆ‘ä¹Ÿä¼šä»‹ç»ä¸€äº›ä»¤äººå…´å¥‹çš„é¢å¤–ç‰¹æ€§ğŸ¤©

> * [JavaScript Visualized: Event Loop](https://dev.to/lydiahallie/javascript-visualized-event-loop-3dif)
> * ç¬”è€…ç¿»è¯‘çš„[ä¸­æ–‡ç‰ˆæœ¬](https://zhuanlan.zhihu.com/p/137276025)

### ä»‹ç»
åœ¨ä¹¦å†™`JavaScript`çš„æ—¶å€™ï¼Œæˆ‘ç»å¸¸ä¸å¾—ä¸å»å¤„ç†ä¸€äº›ä¾èµ–äºå…¶å®ƒä»»åŠ¡çš„ä»»åŠ¡ï¼æ¯”å¦‚è¯´æˆ‘ä»¬æƒ³è¦å¾—åˆ°ä¸€ä¸ªå›¾ç‰‡ï¼Œå¯¹å…¶è¿›è¡Œå‹ç¼©ï¼Œåº”ç”¨ä¸€ä¸ªæ»¤é•œï¼Œç„¶åä¿å­˜å®ƒğŸ“¸ã€‚

æˆ‘ä»¬æœ€å…ˆéœ€è¦åšçš„äº‹æƒ…æ˜¯å¾—åˆ°æˆ‘ä»¬æƒ³è¦ç¼–è¾‘çš„å›¾ç‰‡ã€‚`getImage`å‡½æ•°å¯ä»¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼ä¸€æ—¦å›¾ç‰‡è¢«æˆåŠŸåŠ è½½ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’é‚£ä¸ªå€¼åˆ°ä¸€ä¸ª`resizeImage`å‡½æ•°ã€‚å½“å›¾ç‰‡å·²ç»è¢«æˆåŠŸåœ°é‡æ–°è°ƒæ•´å¤§å°æ—¶ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨`applyFilter`å‡½æ•°ä¸­ä¸ºå›¾ç‰‡åº”ç”¨ä¸€ä¸ªæ»¤é•œã€‚åœ¨å›¾ç‰‡è¢«å‹ç¼©å’Œæ·»åŠ æ»¤é•œåï¼Œæˆ‘ä»¬æƒ³è¦ä¿å­˜å›¾ç‰‡å¹¶ä¸”è®©ç”¨æˆ·çŸ¥é“æ‰€æœ‰çš„äº‹æƒ…éƒ½æ­£ç¡®åœ°å®Œæˆäº†ï¼ğŸ¥³

æœ€åï¼Œæˆ‘ä»¬å¯èƒ½å¾—åˆ°è¿™æ ·çš„ç»“æœ:
![](https://res.cloudinary.com/practicaldev/image/fetch/s---Kv6sJn7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/ixceqsql5hpdq8txx43s.png)

é¢ï¼Œæ³¨æ„åˆ°äº†å—ï¼Ÿå°½ç®¡å®ƒå®Œæˆäº†äº‹æƒ…ï¼Œä½†æ˜¯å®Œæˆçš„å¹¶ä¸æ˜¯å¾ˆå¥½ã€‚æˆ‘ä»¬æœ€ç»ˆå¾—åˆ°äº†è®¸å¤šåµŒå¥—çš„å›è°ƒå‡½æ•°ï¼Œè¿™äº›å›è°ƒå‡½æ•°ä¾èµ–äºå‰ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚è¿™é€šå¸¸è¢«ç§°ä¸º[å›è°ƒåœ°ç‹±](http://callbackhell.com/)ï¼Œç”±äºæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°äº†å¤§é‡åµŒå¥—çš„å›è°ƒå‡½æ•°ï¼Œè¿™ä½¿æˆ‘ä»¬çš„ä»£ç é˜…è¯»èµ·æ¥ç‰¹åˆ«å›°éš¾ã€‚

å¹¸è¿çš„ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªå«åš`Promise`çš„ä¸œè¥¿æ¥å¸®åŠ©æˆ‘ä»¬æ‘†è„±å›°å¢ƒï¼è®©æˆ‘ä»¬çœ‹çœ‹`promise`æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•åœ¨ç±»ä¼¼äºä¸Šè¿°çš„æƒ…å†µä¸‹å¸®åŠ©æˆ‘ä»¬çš„ã€‚ğŸ˜ƒ

### `Promise`è¯­æ³•
`ES6`å¼•å…¥äº†`Promise`ã€‚åœ¨è®¸å¤šæ•™ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šè¯»åˆ°è¿™æ ·çš„å†…å®¹ï¼š
> `Promise`æ˜¯ä¸€ä¸ªå€¼çš„å ä½ç¬¦ï¼Œè¿™ä¸ªå€¼åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´è¦ä¹ˆ`resolve`è¦ä¹ˆ`reject`

å¯¹äºæˆ‘æ¥è¯´ï¼Œè¿™æ ·çš„è§£é‡Šä»æ²¡æœ‰è®©äº‹æƒ…å˜å¾—æ›´æ¸…æ¥šã€‚äº‹å®ä¸Šï¼Œå®ƒåªæ˜¯è®©æˆ‘æ„Ÿè§‰`Promise`æ˜¯ä¸€ä¸ªå¥‡æ€ªçš„ã€æ¨¡ç³Šçš„ã€ä¸å¯é¢„æµ‹çš„ä¸€æ®µé­”æ³•ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹çœ‹`promise`çœŸæ­£æ˜¯æ˜¯ä»€ä¹ˆï¼Ÿ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°çš„`Promise`æ„é€ å™¨åˆ›å»ºä¸€ä¸ª`promise`ã€‚

å¥½é…·ï¼Œè®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ï¼
![](https://res.cloudinary.com/practicaldev/image/fetch/s--phTVdCKA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/79zi452hphe7ecylhozy.gif)

ç­‰ç­‰ï¼Œåˆšåˆšå¾—åˆ°çš„è¿”å›æ˜¯ä»€ä¹ˆï¼Ÿ

`Promise`æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€ä¸ªçŠ¶æ€`[[PromiseStatus]]`å’Œä¸€ä¸ªå€¼`[[PromiseValue]]`ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°`[[PromiseStatus]]`çš„å€¼æ˜¯`pending`,`promise`çš„å€¼æ˜¯`undefined`

ä¸è¦æ‹…å¿ƒ - ä½ å°†æ°¸è¿œä¸ä¼šä¸è¿™ä¸ªå¯¹è±¡è¿›è¡Œäº¤äº’ï¼Œä½ ç”šè‡³ä¸èƒ½è®¿é—®`[[PromiseStatus]]`å’Œ`[[PromiseValue]]`è¿™ä¿©ä¸ªå±æ€§ï¼  
ç„¶è€Œï¼Œåœ¨ä½¿ç”¨`Promise`çš„æ—¶å€™ï¼Œè¿™äº›å±æ€§çš„å€¼æ˜¯éå¸¸é‡è¦çš„ã€‚

`PromiseStatus`çš„å€¼ï¼Œä¹Ÿå°±æ˜¯`Promise`çš„çŠ¶æ€ï¼Œå¯ä»¥æ˜¯ä¸€ä¸‹ä¸‰ä¸ªå€¼ä¹‹ä¸€ï¼š

* âœ…`fulfilled`: `promise`å·²ç»è¢«`resolved`ã€‚ä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œåœ¨`promise`å†…éƒ¨æ²¡æœ‰é”™è¯¯å‘ç”Ÿã€‚
* âŒ`rejected`: `promise`å·²ç»è¢«`rejected`ã€‚å“å‘¦ï¼ŒæŸäº›äº‹æƒ…å‡ºé”™äº†ã€‚
* â³`pending`: `promies`æš‚æ—¶è¿˜æ²¡æœ‰è¢«è§£å†³ä¹Ÿæ²¡æœ‰è¢«æ‹’ç»ï¼Œä»ç„¶å¤„äº`pending`çŠ¶æ€

å¥½å§ï¼Œè¿™ä¸€åˆ‡å¬èµ·æ¥å¾ˆæ£’ï¼Œä½†æ˜¯ä»€ä¹ˆæ—¶å€™`promise`çš„çŠ¶æ€æ˜¯`pending`ã€`fulfilled`æˆ–`rejected`? ä¸ºä»€ä¹ˆè¿™ä¸ªçŠ¶æ€å¾ˆé‡è¦ï¼Ÿ

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ä¸º`Promise`æ„é€ å™¨ä¼ é€’äº†ä¸€ä¸ªç®€å•çš„å›è°ƒå‡½æ•°`()=> {}`ã€‚ç„¶è€Œï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°å®é™…ä¸Šæ¥å—ä¿©ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ç»å¸¸è¢«å«åš`resolve`æˆ–`res`,å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œ åœ¨`Promise`åº”è¯¥**è§£å†³(`resolve`)**çš„æ—¶å€™ä¼šè¢«è°ƒç”¨ã€‚ç¬¬äºŒä¸ªå‚æ•°çš„å€¼ç»å¸¸è¢«å«åš`reject`æˆ–`rej`,å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨`Promise`å‡ºç°ä¸€äº›é”™è¯¯åº”è¯¥è¢«æ‹’ç»çš„æ—¶å€™è¢«è°ƒç”¨ã€‚
![](https://res.cloudinary.com/practicaldev/image/fetch/s--9A_mOYMP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/duen4peq0bdr55cka5ya.png)

è®©æˆ‘ä»¬å°è¯•çœ‹çœ‹å½“æˆ‘ä»¬è°ƒç”¨`resolve`æˆ–`reject`æ–¹æ³•æ—¶å¾—åˆ°çš„æ—¥å¿—ã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼ŒæŠŠ`resolve`æ–¹æ³•å«åš`res`,æŠŠ`reject`æ–¹æ³•å«åš`rej`ã€‚
![](https://res.cloudinary.com/practicaldev/image/fetch/s--qKIq-sYt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/z0b9v0h7aiq073l5tl2l.gif)

å¤ªå¥½äº†ï¼æˆ‘ä»¬ç»ˆäºçŸ¥é“å¦‚ä½•æ‘†è„±`pending`çŠ¶æ€å’Œ`undefined`å€¼äº†ï¼å½“æˆ‘ä»¬è°ƒç”¨`resolve`æ–¹æ³•ï¼Œ`promise`çš„çŠ¶æ€æ—¶`fulfilled`ã€‚å½“æˆ‘ä»¬è°ƒç”¨`reject`æ–¹æ³•ï¼Œ`promise`çš„çŠ¶æ€æ˜¯`rejected`ã€‚

`promise`çš„å€¼ï¼Œå³`[[PromiseValue]]`çš„å€¼ï¼Œæ˜¯æˆ‘ä»¬ä½œä¸ºå‚æ•°ä¼ é€’ç»™`resolve`æˆ–`reject`æ–¹æ³•çš„å€¼ã€‚

> æœ‰è¶£çš„äº‹å®ï¼Œæˆ‘è®©[`Jake Archibald`](https://twitter.com/jaffathecake)æ ¡å¯¹è¿™ç¯‡æ–‡ç« ï¼Œå®ƒæŒ‡å‡ºå½“å‰çš„çŠ¶æ€æ˜¾ç¤ºä¸º`resolved`è€Œä¸æ˜¯`fulfuilled`å®é™…ä¸Šæ˜¯`Chrome`ä¸­çš„[ä¸€ä¸ª`bug`](https://twitter.com/jaffathecake/status/1248179232775319559)ã€‚æ„Ÿè°¢[`Mathias Bynens`](https://twitter.com/mathias)ï¼Œè¿™ä¸ªé—®é¢˜ç°åœ¨å·²ç»åœ¨`Canary`ä¸­ä¿®å¤äº†ã€‚

å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“å¦‚ä½•æ›´å¥½æ§åˆ¶é‚£ä¸ªæ¨¡ç³Šçš„`Promise`å¯¹è±¡ã€‚ä½†æ˜¯ä»–è¢«ç”¨æ¥åšä»€ä¹ˆå‘¢ï¼Ÿ

åœ¨ä»‹ç»ç« èŠ‚ï¼Œæˆ‘å±•ç¤ºäº†ä¸€ä¸ªè·å¾—å›¾ç‰‡ã€å‹ç¼©å›¾ç‰‡ã€ä¸ºå›¾ç‰‡åº”ç”¨è¿‡æ»¤å™¨å¹¶ä¿å­˜å®ƒçš„ä¾‹å­ï¼æœ€ç»ˆï¼Œè¿™å˜æˆäº†ä¸€ä¸ªæ··ä¹±çš„åµŒå¥—å›è°ƒã€‚

å¹¸è¿çš„ï¼Œ`Promise`å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ï¼é¦–å…ˆï¼Œè®©æˆ‘ä»¬é‡å†™æ•´ä¸ªä»£ç å—ï¼Œä»¥ä¾¿æ¯ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ª`Promise`ä»£æ›¿ä¹‹å‰çš„å‡½æ•°ã€‚

å¦‚æœå›¾ç‰‡è¢«åŠ è½½å®Œæˆå¹¶ä¸”ä¸€åˆ‡æ­£å¸¸ï¼Œè®©æˆ‘ä»¬ç”¨åŠ è½½å®Œçš„å›¾ç‰‡**è§£å†³(`resolve`)**`promise`!å¦åˆ™ï¼Œå¦‚æœåœ¨åŠ è½½æ–‡ä»¶æ—¶æŸä¸ªåœ°æ–¹æœ‰ä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬å°†ä¼šç”¨å‘ç”Ÿçš„é”™è¯¯**æ‹’ç»(`reject`)**`promise`ã€‚
![](https://res.cloudinary.com/practicaldev/image/fetch/s--r9xngcNz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/iebp0rzfnfqsrmmjplme.png)

è®©æˆ‘ä»¬çœ‹ä¸‹å½“æˆ‘ä»¬åœ¨ç»ˆç«¯è¿è¡Œè¿™æ®µä»£ç æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
![](https://res.cloudinary.com/practicaldev/image/fetch/s--uERkfSWf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/wsu5nn26dp4elcwh764m.gif)

éå¸¸é…·ï¼å°±åƒæˆ‘ä»¬æ‰€æœŸæœ›çš„ä¸€æ ·ï¼Œ`promise`å¾—åˆ°äº†è§£ææ•°æ®çš„å€¼ã€‚

ä½†æ˜¯ç°åœ¨å‘¢ï¼Ÿæˆ‘ä»¬ä¸å…³å¿ƒæ•´ä¸ª`promise`å¯¹è±¡ï¼Œæˆ‘ä»¬åªå…³å¿ƒæ•°æ®çš„å€¼ï¼å¹¸è¿çš„ï¼Œæœ‰å†…ç½®çš„æ–¹æ³•æ¥å¾—åˆ°`promise`çš„å€¼ã€‚

å¯¹äºä¸€ä¸ª`promise`, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä¸Šé¢çš„3ä¸ªæ–¹æ³•ï¼š

* `.then()`: åœ¨ä¸€ä¸ª`promise`è¢«`resolved`åè°ƒç”¨
* `.catch()`: åœ¨ä¸€ä¸ª`promise`è¢«`rejected`åè¢«è°ƒç”¨
* `.finally()`: ä¸è®º`promise`æ˜¯è¢«`resolved`è¿˜æ˜¯`reject`æ€»æ˜¯è°ƒç”¨
![](https://res.cloudinary.com/practicaldev/image/fetch/s--19tIvFJQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/mu1aqqnyfjsfon5hwrtw.png)

`.then`æ–¹æ³•æ¥æ”¶ä¼ é€’ä¸ª`resolve`æ–¹æ³•çš„å€¼ã€‚
![](https://res.cloudinary.com/practicaldev/image/fetch/s--DZld0c-0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/11vxhn9cun7stpjbdi80.gif)

`.catch`æ–¹æ³•æ¥æ”¶ä¼ é€’ç»™`rejected`æ–¹æ³•çš„å€¼
![](https://res.cloudinary.com/practicaldev/image/fetch/s--e9SZHcPk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/v5y24jz4u89flazvdyn4.gif)

æœ€ç»ˆï¼Œæˆ‘ä»¬æ‹¥æœ‰äº†`promise`è¢«è§£å†³å(`resolved`)çš„å€¼ï¼Œå¹¶ä¸éœ€è¦æ•´ä¸ª`promise`å¯¹è±¡ï¼ç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªå€¼åšä»»ä½•æˆ‘ä»¬æƒ³åšçš„äº‹ã€‚

é¡ºä¾¿æé†’ä¸€ä¸‹ï¼Œå½“ä½ çŸ¥é“ä¸€ä¸ª`promise`æ€»æ˜¯`resolve`æˆ–è€…æ€»æ˜¯`reject`çš„æ—¶å€™ï¼Œä½ å¯ä»¥å†™`Promise.resolve`æˆ–`Promise.reject`ï¼Œä¼ å…¥ä½ æƒ³è¦`reject`æˆ–`resolve`çš„`promise`çš„å€¼ã€‚
![](https://res.cloudinary.com/practicaldev/image/fetch/s--61Gva3Ze--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/90hxwjfadzslvdbkr4l8.png)

åœ¨ä¸‹è¾¹çš„ä¾‹å­ä¸­ä½ å°†ä¼šç»å¸¸çœ‹åˆ°è¿™ä¸ªè¯­æ³•ğŸ˜„

åœ¨`getImage`çš„ä¾‹å­ä¸­ï¼Œä¸ºäº†è¿è¡Œå®ƒä»¬ï¼Œæˆ‘ä»¬æœ€ç»ˆä¸å¾—ä¸åµŒå¥—å¤šä¸ªå›è°ƒã€‚å¹¸è¿çš„ï¼Œ`.then`å¤„ç†å™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆè¿™ä»¶äº‹ï¼ğŸ¥³

`.then`å®ƒè‡ªå·±çš„æ‰§è¡Œç»“æœæ˜¯ä¸€ä¸ª`promise`ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é“¾æ¥ä»»æ„æ•°é‡çš„`.then`ï¼šå‰ä¸€ä¸ª`then`å›è°ƒçš„ç»“æœå°†ä¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸‹ä¸€ä¸ª`then`å›è°ƒï¼
![](https://res.cloudinary.com/practicaldev/image/fetch/s--X8h-NDc2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/i6busbetmoya9vny2eku.png)

åœ¨`getImage`ç¤ºä¾‹ä¸­ï¼Œä¸ºäº†ä¼ é€’è¢«å¤„ç†çš„å›¾ç‰‡åˆ°ä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é“¾æ¥å¤šä¸ª`then`å›è°ƒã€‚ç›¸æ¯”äºä¹‹å‰æœ€ç»ˆå¾—åˆ°è®¸å¤šåµŒå¥—å›è°ƒï¼Œç°åœ¨æˆ‘ä»¬å¾—åˆ°äº†æ•´æ´çš„`then`é“¾ã€‚
![](https://res.cloudinary.com/practicaldev/image/fetch/s--e1nVrqe1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/u9l3lxwxlxgv2edv79xh.png)

å®Œç¾!è¿™ä¸ªè¯­æ³•çœ‹èµ·æ¥å·²ç»æ¯”ä¹‹å‰çš„åµŒå¥—å›è°ƒå¥½å¤šäº†ã€‚

### å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡(macrotask and microtask)
æˆ‘ä»¬çŸ¥é“äº†ä¸€äº›å¦‚ä½•å’Œåˆ›å»º`promise`ä»¥åŠå¦‚ä½•æå–å‡º`promise`çš„å€¼çš„æ–¹æ³•ã€‚è®©æˆ‘ä»¬ä¸ºè„šæœ¬æ·»åŠ ä¸€äº›æ›´å¤šçš„ä»£ç å¹¶ä¸”å†æ¬¡è¿è¡Œå®ƒï¼š
![](https://res.cloudinary.com/practicaldev/image/fetch/s--uNG7sXon--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/ey4ubnv5yjgi6hbh97xq.gif)

ç­‰ä¸‹ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿï¼ğŸ¤¯

é¦–å…ˆï¼Œ`Start!`è¢«è¾“å‡ºã€‚å¥½çš„ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†é‚£ä¸€ä¸ªå³å°†åˆ°æ¥çš„æ¶ˆæ¯ï¼š`console.log('Start!')`åœ¨æœ€å‰ä¸€è¡Œè¾“å‡ºï¼ç„¶è€Œï¼Œç¬¬äºŒä¸ªè¢«æ‰“å°çš„å€¼æ˜¯`End!`ï¼Œå¹¶ä¸æ˜¯`promise`è¢«è§£å†³çš„å€¼ï¼åªæœ‰åœ¨`End!`è¢«æ‰“å°ä¹‹åï¼Œ`promise`çš„å€¼æ‰ä¼šè¢«æ‰“å°ã€‚è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

æˆ‘ä»¬æœ€ç»ˆçœ‹åˆ°äº†`promise`çœŸæ­£çš„åŠ›é‡ï¼ğŸš€ å°½ç®¡`JavaScript`æ˜¯å•çº¿ç¨‹çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`Promise`æ·»åŠ å¼‚æ­¥ä»»åŠ¡ï¼

ç­‰ç­‰ï¼Œæˆ‘ä»¬ä¹‹å‰æ²¡è§è¿‡è¿™ç§æƒ…å†µå—ï¼ŸğŸ¤”åœ¨[`JavaScript event loop`](https://dev.to/lydiahallie/javascript-visualized-event-loop-3dif)ä¸­ï¼Œæˆ‘ä»¬ä¸æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿçš„æ–¹æ³•å¦‚`setTimeout`åˆ›å»ºæŸç±»å¼‚æ­¥è¡Œä¸ºå—ï¼Ÿ

æ˜¯çš„ï¼ç„¶è€Œï¼Œåœ¨äº‹ä»¶å¾ªç¯å†…éƒ¨ï¼Œå®é™…ä¸Šæœ‰2ä¸­ç±»å‹çš„é˜Ÿåˆ—ï¼š**å®ä»»åŠ¡(macro)é˜Ÿåˆ—**(æˆ–è€…åªæ˜¯å«åš**ä»»åŠ¡é˜Ÿåˆ—**)å’Œ**å¾®ä»»åŠ¡é˜Ÿåˆ—**ã€‚(å®)ä»»åŠ¡é˜Ÿåˆ—ç”¨äº**å®ä»»åŠ¡**ï¼Œå¾®ä»»åŠ¡é˜Ÿåˆ—ç”¨äº**å¾®ä»»åŠ¡**ã€‚

é‚£ä¹ˆä»€ä¹ˆæ˜¯å®ä»»åŠ¡ï¼Œä»€ä¹ˆæ˜¯å¾®ä»»åŠ¡å‘¢ï¼Ÿå°½ç®¡ä»–ä»¬æ¯”æˆ‘åœ¨è¿™é‡Œä»‹ç»çš„è¦å¤šä¸€äº›ï¼Œä½†æ˜¯æœ€å¸¸ç”¨çš„å·²ç»è¢«å±•ç¤ºåœ¨ä¸‹é¢çš„è¡¨æ ¼ä¸­ï¼
![](https://raw.githubusercontent.com/wangkaiwd/drawing-bed/master/20200503233943.png)

æˆ‘ä»¬çœ‹åˆ°`Promise`åœ¨å¾®ä»»åŠ¡åˆ—è¡¨ä¸­ï¼ğŸ˜ƒ